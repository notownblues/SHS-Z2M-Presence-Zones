<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHS Z2M Presence Zone Configurator</title>
    <link rel="stylesheet" href="/src/style.css">
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <span class="header-title">Zone Configurator</span>
            <div class="header-right">
                <div class="connection-status">
                    <span class="status-indicator" id="mqttStatus"></span>
                    <span id="mqttStatusText">Disconnected from MQTT</span>
                </div>
                <button class="dark-mode-toggle" id="darkModeToggle" title="Toggle Dark/Light Mode">
                    <svg class="sun-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"/>
                        <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                    </svg>
                    <svg class="moon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Left Sidebar: Furniture/Objects -->
            <aside class="furniture-sidebar" id="furnitureSidebar">
                <h3 class="sidebar-title">Objects</h3>
                <div class="furniture-grid">
                    <!-- Seating -->
                    <button class="furniture-item" data-mode="place-furniture" data-furniture="chair" title="Armchair">
                        <svg width="32" height="32" viewBox="0 0 48 48">
                            <rect x="10" y="4" width="28" height="14" rx="4" fill="#C05A38"/>
                            <rect x="6" y="12" width="36" height="24" rx="4" fill="#E07850"/>
                            <rect x="12" y="16" width="24" height="16" rx="2" fill="#F09070"/>
                            <rect x="2" y="10" width="8" height="22" rx="2" fill="#C05A38"/>
                            <rect x="38" y="10" width="8" height="22" rx="2" fill="#C05A38"/>
                        </svg>
                        <span>Armchair</span>
                    </button>
                    <button class="furniture-item" data-mode="place-furniture" data-furniture="dining-chair" title="Dining Chair">
                        <svg width="32" height="32" viewBox="0 0 48 48">
                            <rect x="14" y="4" width="20" height="8" rx="2" fill="#8B5A2B"/>
                            <rect x="16" y="12" width="16" height="20" rx="2" fill="#D4A574"/>
                            <rect x="12" y="32" width="24" height="12" rx="2" fill="#8B5A2B"/>
                            <rect x="16" y="36" width="16" height="6" rx="1" fill="#C4956A"/>
                        </svg>
                        <span>Dining Chair</span>
                    </button>
                    <button class="furniture-item" data-mode="place-furniture" data-furniture="sofa" title="Sofa">
                        <svg width="32" height="32" viewBox="0 0 48 48">
                            <rect x="6" y="4" width="36" height="12" rx="4" fill="#3A5A8A"/>
                            <rect x="4" y="10" width="40" height="28" rx="4" fill="#4A6FA5"/>
                            <rect x="8" y="14" width="14" height="20" rx="2" fill="#6090C0"/>
                            <rect x="26" y="14" width="14" height="20" rx="2" fill="#6090C0"/>
                            <rect x="2" y="8" width="6" height="28" rx="2" fill="#3A5A8A"/>
                            <rect x="40" y="8" width="6" height="28" rx="2" fill="#3A5A8A"/>
                        </svg>
                        <span>Sofa</span>
                    </button>
                    <button class="furniture-item" data-mode="place-furniture" data-furniture="bed" title="Bed">
                        <svg width="32" height="32" viewBox="0 0 48 48">
                            <rect x="4" y="4" width="40" height="40" rx="4" fill="#5D4037"/>
                            <rect x="8" y="8" width="32" height="32" rx="2" fill="#E8E8E8"/>
                            <rect x="4" y="4" width="8" height="40" rx="2" fill="#4A3228"/>
                            <rect x="14" y="10" width="10" height="12" rx="2" fill="#F5F0E6"/>
                            <rect x="14" y="26" width="10" height="12" rx="2" fill="#F5F0E6"/>
                        </svg>
                        <span>Bed</span>
                    </button>

                    <!-- Tables -->
                    <button class="furniture-item" data-mode="place-furniture" data-furniture="table" title="Table">
                        <svg width="32" height="32" viewBox="0 0 48 48">
                            <rect x="4" y="4" width="40" height="40" rx="4" fill="#6B4423"/>
                            <rect x="8" y="8" width="32" height="32" rx="2" fill="#D4A574"/>
                            <line x1="10" y1="16" x2="38" y2="16" stroke="#8B5A2B" stroke-width="1.5" opacity="0.4"/>
                            <line x1="10" y1="24" x2="38" y2="24" stroke="#8B5A2B" stroke-width="1.5" opacity="0.4"/>
                            <line x1="10" y1="32" x2="38" y2="32" stroke="#8B5A2B" stroke-width="1.5" opacity="0.4"/>
                        </svg>
                        <span>Table</span>
                    </button>
                    <button class="furniture-item" data-mode="place-furniture" data-furniture="desk" title="Desk">
                        <svg width="32" height="32" viewBox="0 0 48 48">
                            <rect x="4" y="8" width="40" height="32" rx="2" fill="#5D4037"/>
                            <rect x="6" y="10" width="36" height="28" rx="1" fill="#8D6E63"/>
                            <rect x="8" y="22" width="14" height="14" rx="1" fill="#6D4C41"/>
                            <circle cx="18" cy="29" r="1.5" fill="#FFD700"/>
                            <rect x="28" y="12" width="12" height="8" rx="1" fill="#4A4A4A"/>
                            <rect x="30" y="14" width="8" height="4" fill="#6B6B6B"/>
                        </svg>
                        <span>Desk</span>
                    </button>
                    <button class="furniture-item" data-mode="place-furniture" data-furniture="bedside-table" title="Bedside Table">
                        <svg width="32" height="32" viewBox="0 0 48 48">
                            <rect x="8" y="8" width="32" height="32" rx="3" fill="#6B4423"/>
                            <rect x="10" y="10" width="28" height="28" rx="2" fill="#8B5A2B"/>
                            <line x1="10" y1="24" x2="38" y2="24" stroke="#5D4037" stroke-width="2"/>
                            <circle cx="24" cy="17" r="2" fill="#FFD700"/>
                            <circle cx="24" cy="31" r="2" fill="#FFD700"/>
                        </svg>
                        <span>Bedside Table</span>
                    </button>

                    <!-- Storage -->
                    <button class="furniture-item" data-mode="place-furniture" data-furniture="cabinet" title="Cabinet">
                        <svg width="32" height="32" viewBox="0 0 48 48">
                            <rect x="4" y="4" width="40" height="40" rx="4" fill="#5D4037"/>
                            <rect x="8" y="8" width="32" height="32" rx="2" fill="#8D6E63"/>
                            <line x1="8" y1="24" x2="40" y2="24" stroke="#4A3228" stroke-width="3"/>
                            <line x1="24" y1="25" x2="24" y2="38" stroke="#4A3228" stroke-width="3"/>
                            <circle cx="18" cy="32" r="2.5" fill="#FFD700"/>
                            <circle cx="30" cy="32" r="2.5" fill="#FFD700"/>
                            <circle cx="24" cy="16" r="2.5" fill="#FFD700"/>
                        </svg>
                        <span>Cabinet</span>
                    </button>
                    <button class="furniture-item" data-mode="place-furniture" data-furniture="drawers" title="Drawers">
                        <svg width="32" height="32" viewBox="0 0 48 48">
                            <rect x="6" y="4" width="36" height="40" rx="3" fill="#5D4037"/>
                            <rect x="8" y="6" width="32" height="10" rx="1" fill="#8D6E63"/>
                            <rect x="8" y="18" width="32" height="10" rx="1" fill="#8D6E63"/>
                            <rect x="8" y="30" width="32" height="10" rx="1" fill="#8D6E63"/>
                            <circle cx="24" cy="11" r="1.5" fill="#C0C0C0"/>
                            <circle cx="24" cy="23" r="1.5" fill="#C0C0C0"/>
                            <circle cx="24" cy="35" r="1.5" fill="#C0C0C0"/>
                        </svg>
                        <span>Drawers</span>
                    </button>
                    <button class="furniture-item" data-mode="place-furniture" data-furniture="wardrobe" title="Wardrobe">
                        <svg width="32" height="32" viewBox="0 0 48 48">
                            <rect x="4" y="4" width="40" height="40" rx="3" fill="#4A3228"/>
                            <rect x="6" y="6" width="18" height="36" rx="1" fill="#6B4423"/>
                            <rect x="24" y="6" width="18" height="36" rx="1" fill="#6B4423"/>
                            <line x1="24" y1="6" x2="24" y2="42" stroke="#3D2817" stroke-width="2"/>
                            <circle cx="20" cy="24" r="2" fill="#C0C0C0"/>
                            <circle cx="28" cy="24" r="2" fill="#C0C0C0"/>
                        </svg>
                        <span>Wardrobe</span>
                    </button>

                    <!-- Electronics -->
                    <button class="furniture-item" data-mode="place-furniture" data-furniture="tv" title="TV">
                        <svg width="32" height="32" viewBox="0 0 48 48">
                            <rect x="4" y="10" width="40" height="24" rx="2" fill="#1a1a1a"/>
                            <rect x="6" y="12" width="36" height="20" rx="1" fill="#2d2d2d"/>
                            <rect x="8" y="14" width="32" height="16" fill="#4a90d9"/>
                            <rect x="20" y="34" width="8" height="4" fill="#1a1a1a"/>
                            <rect x="14" y="38" width="20" height="2" rx="1" fill="#1a1a1a"/>
                        </svg>
                        <span>TV</span>
                    </button>
                    <button class="furniture-item" data-mode="place-furniture" data-furniture="speaker" title="Speaker">
                        <svg width="32" height="32" viewBox="0 0 48 48">
                            <rect x="12" y="4" width="24" height="40" rx="4" fill="#2d2d2d"/>
                            <circle cx="24" cy="16" r="6" fill="#1a1a1a"/>
                            <circle cx="24" cy="16" r="4" fill="#3d3d3d"/>
                            <circle cx="24" cy="32" r="8" fill="#1a1a1a"/>
                            <circle cx="24" cy="32" r="6" fill="#3d3d3d"/>
                            <circle cx="24" cy="32" r="2" fill="#1a1a1a"/>
                        </svg>
                        <span>Speaker</span>
                    </button>

                    <!-- Appliances -->
                    <button class="furniture-item" data-mode="place-furniture" data-furniture="fridge" title="Fridge">
                        <svg width="32" height="32" viewBox="0 0 48 48">
                            <rect x="8" y="4" width="32" height="40" rx="3" fill="#E0E0E0"/>
                            <rect x="10" y="6" width="28" height="14" rx="2" fill="#F5F5F5"/>
                            <rect x="10" y="22" width="28" height="20" rx="2" fill="#F5F5F5"/>
                            <line x1="10" y1="20" x2="38" y2="20" stroke="#BDBDBD" stroke-width="2"/>
                            <rect x="32" y="10" width="3" height="6" rx="1" fill="#9E9E9E"/>
                            <rect x="32" y="28" width="3" height="8" rx="1" fill="#9E9E9E"/>
                        </svg>
                        <span>Fridge</span>
                    </button>
                    <button class="furniture-item" data-mode="place-furniture" data-furniture="radiator" title="Radiator">
                        <svg width="32" height="32" viewBox="0 0 48 48">
                            <rect x="4" y="12" width="40" height="24" rx="2" fill="#E0E0E0"/>
                            <rect x="8" y="14" width="4" height="20" rx="1" fill="#BDBDBD"/>
                            <rect x="14" y="14" width="4" height="20" rx="1" fill="#BDBDBD"/>
                            <rect x="20" y="14" width="4" height="20" rx="1" fill="#BDBDBD"/>
                            <rect x="26" y="14" width="4" height="20" rx="1" fill="#BDBDBD"/>
                            <rect x="32" y="14" width="4" height="20" rx="1" fill="#BDBDBD"/>
                            <rect x="38" y="14" width="4" height="20" rx="1" fill="#BDBDBD"/>
                            <circle cx="40" cy="10" r="3" fill="#ef5350"/>
                        </svg>
                        <span>Radiator</span>
                    </button>
                    <button class="furniture-item" data-mode="place-furniture" data-furniture="fan" title="Fan">
                        <svg width="32" height="32" viewBox="0 0 48 48">
                            <circle cx="24" cy="24" r="18" fill="#E8E8E8" stroke="#BDBDBD" stroke-width="2"/>
                            <circle cx="24" cy="24" r="4" fill="#424242"/>
                            <path d="M24 8 Q28 16 24 20 Q20 16 24 8" fill="#78909C"/>
                            <path d="M24 40 Q20 32 24 28 Q28 32 24 40" fill="#78909C"/>
                            <path d="M8 24 Q16 20 20 24 Q16 28 8 24" fill="#78909C"/>
                            <path d="M40 24 Q32 28 28 24 Q32 20 40 24" fill="#78909C"/>
                        </svg>
                        <span>Fan</span>
                    </button>

                    <!-- Fixtures -->
                    <button class="furniture-item" data-mode="place-furniture" data-furniture="window" title="Window">
                        <svg width="32" height="32" viewBox="0 0 48 48">
                            <rect x="4" y="8" width="40" height="32" rx="2" fill="#5D4037"/>
                            <rect x="6" y="10" width="17" height="13" fill="#87CEEB"/>
                            <rect x="25" y="10" width="17" height="13" fill="#87CEEB"/>
                            <rect x="6" y="25" width="17" height="13" fill="#87CEEB"/>
                            <rect x="25" y="25" width="17" height="13" fill="#87CEEB"/>
                            <line x1="24" y1="10" x2="24" y2="38" stroke="#5D4037" stroke-width="2"/>
                            <line x1="6" y1="24" x2="42" y2="24" stroke="#5D4037" stroke-width="2"/>
                        </svg>
                        <span>Window</span>
                    </button>
                    <button class="furniture-item" data-mode="place-furniture" data-furniture="lamp" title="Lamp">
                        <svg width="32" height="32" viewBox="0 0 48 48">
                            <circle cx="24" cy="24" r="18" fill="#FFFACD" opacity="0.3"/>
                            <circle cx="24" cy="24" r="12" fill="#F0E68C"/>
                            <circle cx="24" cy="24" r="8" fill="#FFFACD"/>
                            <circle cx="24" cy="24" r="3" fill="#DAA520"/>
                        </svg>
                        <span>Lamp</span>
                    </button>
                    <button class="furniture-item" data-mode="place-furniture" data-furniture="plant" title="Plant">
                        <svg width="32" height="32" viewBox="0 0 48 48">
                            <circle cx="16" cy="28" r="8" fill="#388E3C"/>
                            <circle cx="32" cy="28" r="8" fill="#388E3C"/>
                            <circle cx="24" cy="20" r="10" fill="#4CAF50"/>
                            <circle cx="18" cy="24" r="6" fill="#4CAF50"/>
                            <circle cx="30" cy="24" r="6" fill="#4CAF50"/>
                            <ellipse cx="24" cy="40" rx="8" ry="4" fill="#8B5A2B"/>
                        </svg>
                        <span>Plant</span>
                    </button>
                </div>
            </aside>

            <!-- Center Panel: Visualization -->
            <section class="visualization-panel">
                <!-- Drawing Toolbar -->
                <div class="drawing-toolbar">
                    <div class="toolbar-group">
                        <button class="tool-btn active" data-mode="select" title="Select / Edit">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 3l14 9-7 2-3 7-4-18z"/>
                            </svg>
                        </button>
                        <button class="tool-btn" data-mode="draw-rectangle" title="Draw Rectangle Zone">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="1"/>
                            </svg>
                        </button>
                        <button class="tool-btn" data-mode="draw-polygon" title="Draw Polygon Zone">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 3L21 9L18 20H6L3 9L12 3Z"/>
                            </svg>
                        </button>
                    </div>
                    <div class="toolbar-divider"></div>
                    <div class="toolbar-group">
                        <button class="tool-btn" data-mode="place-entrance" title="Mark Door/Entrance">
                            <svg width="18" height="18" viewBox="0 0 24 24">
                                <path d="M4 4 L4 20" stroke="#7F8C8D" stroke-width="2.5" stroke-linecap="round"/>
                                <path d="M4 4 L20 4" stroke="#5D6D7E" stroke-width="2.5" stroke-linecap="round"/>
                                <path d="M4 4 A16 16 0 0 1 20 20" stroke="#2C3E50" stroke-width="1.5" stroke-dasharray="3 3" fill="none"/>
                                <circle cx="4" cy="4" r="2.5" fill="#5D6D7E"/>
                                <circle cx="16" cy="4" r="2" fill="#95A5A6"/>
                            </svg>
                        </button>
                        <button class="tool-btn" data-mode="draw-edge" title="Draw Room Edge (Grey-out Area)">
                            <svg width="18" height="18" viewBox="0 0 24 24">
                                <rect x="2" y="2" width="20" height="20" rx="2" fill="none" stroke="#7F8C8D" stroke-width="2" stroke-dasharray="4 2"/>
                                <rect x="4" y="4" width="6" height="16" fill="#6B7280" opacity="0.6"/>
                            </svg>
                        </button>
                    </div>
                    <div class="toolbar-divider"></div>
                    <div class="toolbar-group">
                        <button class="tool-btn" id="rotateMapBtn" title="Rotate Map 90°">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 12a9 9 0 109-9"/>
                                <path d="M12 3L9 6l3 3"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Sensor Status Bar -->
                <div class="sensor-status-bar" id="sensorStatusBar">
                    <div class="status-item">
                        <svg class="status-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="8" r="4"/>
                            <path d="M5 20v-2a7 7 0 0 1 14 0v2"/>
                        </svg>
                        <span class="status-label">Targets:</span>
                        <span class="status-value" id="targetCount">0</span>
                    </div>
                    <div class="status-divider"></div>
                    <div class="status-item">
                        <svg class="status-icon occupancy-icon" id="occupancyIcon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path class="check-mark" d="M8 12l3 3 5-6" style="display: none;"/>
                        </svg>
                        <span class="status-label">Status:</span>
                        <span class="status-value" id="occupancy">Clear</span>
                    </div>
                </div>

                <div class="canvas-container">
                    <canvas id="radarCanvas" width="600" height="600"></canvas>

                    <!-- Floating Action Buttons for Selected Shape -->
                    <div class="shape-actions" id="shapeActions" style="display: none;">
                        <button class="shape-action-btn" id="moveShapeBtn" title="Move">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <path d="M5 9l-3 3 3 3M9 5l3-3 3 3M15 19l-3 3-3-3M19 9l3 3-3 3M2 12h20M12 2v20"/>
                            </svg>
                        </button>
                        <button class="shape-action-btn" id="rotateShapeBtn" title="Rotate 45°">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <path d="M3 12a9 9 0 109-9"/>
                                <path d="M12 3L9 6l3 3"/>
                            </svg>
                        </button>
                        <button class="shape-action-btn size-btn" id="decreaseSizeBtn" title="Decrease Size">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <path d="M5 12h14"/>
                            </svg>
                        </button>
                        <button class="shape-action-btn size-btn" id="increaseSizeBtn" title="Increase Size">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <path d="M12 5v14M5 12h14"/>
                            </svg>
                        </button>
                        <button class="shape-action-btn delete" id="deleteShapeBtn" title="Delete">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <path d="M18 6L6 18M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>

                    <!-- Done Button for Placement Mode -->
                    <div class="placement-done" id="placementDone" style="display: none;">
                        <button class="done-btn" id="doneBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                <path d="M20 6L9 17l-5-5"/>
                            </svg>
                            Done
                        </button>
                        <span class="done-hint">Press Esc to cancel</span>
                    </div>
                </div>

            </section>

            <!-- Right Panel: Controls -->
            <aside class="controls-panel">
                <!-- Room & Sensor Settings -->
                <section class="control-section">
                    <h2>Room & Sensor</h2>
                    <div class="form-group">
                        <label for="mqttTopic">MQTT Topic</label>
                        <input type="text" id="mqttTopic" placeholder="zigbee2mqtt/SHS01" value="">
                        <small class="help-text">Zigbee2MQTT topic for your sensor (e.g., zigbee2mqtt/SHS01).</small>
                    </div>
                    <div class="form-group">
                        <label for="roomName">Room Name</label>
                        <input type="text" id="roomName" placeholder="Living Room" value="">
                        <small class="help-text">Name for this room/sensor configuration.</small>
                    </div>
                    <div class="form-group">
                        <label for="sensorSelector">Saved Rooms</label>
                        <select id="sensorSelector">
                            <option value="">-- Select a saved room --</option>
                        </select>
                        <small class="help-text">Select a saved room to load its configuration.</small>
                    </div>
                    <div class="form-group button-row">
                        <button id="saveRoomBtn" class="btn btn-success" title="Save room configuration">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
                                <polyline points="17 21 17 13 7 13 7 21"/>
                                <polyline points="7 3 7 8 15 8"/>
                            </svg>
                            Save Configuration
                        </button>
                        <button id="deleteRoomBtn" class="btn btn-danger" title="Delete room configuration">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3 6 5 6 21 6"/>
                                <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                                <line x1="10" y1="11" x2="10" y2="17"/>
                                <line x1="14" y1="11" x2="14" y2="17"/>
                            </svg>
                            Delete
                        </button>
                    </div>
                    <div class="form-group" style="margin-top: 10px;">
                        <button id="positionReportingBtn" class="btn btn-secondary" disabled>
                            Enable Position Reporting
                        </button>
                        <small style="color: #8b949e;">
                            Toggle X/Y position updates via Zigbee. Enable when configuring zones, disable after.
                        </small>
                    </div>
                </section>

                <!-- Zone Configuration -->
                <section class="control-section">
                    <div class="section-header">
                        <h2>Zone Configuration</h2>
                        <span class="auto-save-indicator" id="saveIndicator">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 6L9 17l-5-5"/>
                            </svg>
                            Saved
                        </span>
                    </div>

                    <!-- Zone Type Selection -->
                    <div class="form-group">
                        <label for="zoneType">Zone Mode</label>
                        <select id="zoneType">
                            <option value="0">Off - Detect All Targets</option>
                            <option value="1">Include - Only Inside Zones</option>
                            <option value="2">Exclude - Only Outside Zones</option>
                        </select>
                        <small class="help-text">Include: Only detect targets inside zones. Exclude: Ignore targets inside zones.</small>
                    </div>

                    <!-- Zone Summary Cards -->
                    <div class="zone-cards">
                        <div class="zone-card" id="zone1Card" data-zone="1">
                            <div class="zone-card-header">
                                <div class="zone-card-left">
                                    <div class="zone-card-color zone1"></div>
                                    <div class="zone-card-title-group">
                                        <span class="zone-card-title">Zone 1</span>
                                        <select id="zone1Type" class="zone-type-select" title="Zone Type">
                                            <option value="detection">Detection</option>
                                            <option value="interference">Interference</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="zone-card-right">
                                    <svg class="zone-occupancy-icon" id="zone1OccupancyIcon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" title="Zone Occupancy">
                                        <circle cx="12" cy="12" r="10"/>
                                    </svg>
                                    <button class="zone-clear-btn" id="zone1ClearBtn" title="Clear Zone">CLEAR</button>
                                </div>
                            </div>
                            <div class="zone-card-info">
                                <span id="zone1Info" class="zone-info-text">Click to draw on map</span>
                            </div>
                        </div>

                        <div class="zone-card" id="zone2Card" data-zone="2">
                            <div class="zone-card-header">
                                <div class="zone-card-left">
                                    <div class="zone-card-color zone2"></div>
                                    <div class="zone-card-title-group">
                                        <span class="zone-card-title">Zone 2</span>
                                        <select id="zone2Type" class="zone-type-select" title="Zone Type">
                                            <option value="detection">Detection</option>
                                            <option value="interference">Interference</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="zone-card-right">
                                    <svg class="zone-occupancy-icon" id="zone2OccupancyIcon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" title="Zone Occupancy">
                                        <circle cx="12" cy="12" r="10"/>
                                    </svg>
                                    <button class="zone-clear-btn" id="zone2ClearBtn" title="Clear Zone">CLEAR</button>
                                </div>
                            </div>
                            <div class="zone-card-info">
                                <span id="zone2Info" class="zone-info-text">Click to draw on map</span>
                            </div>
                        </div>

                        <div class="zone-card" id="zone3Card" data-zone="3">
                            <div class="zone-card-header">
                                <div class="zone-card-left">
                                    <div class="zone-card-color zone3"></div>
                                    <div class="zone-card-title-group">
                                        <span class="zone-card-title">Zone 3</span>
                                        <select id="zone3Type" class="zone-type-select" title="Zone Type">
                                            <option value="detection">Detection</option>
                                            <option value="interference">Interference</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="zone-card-right">
                                    <svg class="zone-occupancy-icon" id="zone3OccupancyIcon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" title="Zone Occupancy">
                                        <circle cx="12" cy="12" r="10"/>
                                    </svg>
                                    <button class="zone-clear-btn" id="zone3ClearBtn" title="Clear Zone">CLEAR</button>
                                </div>
                            </div>
                            <div class="zone-card-info">
                                <span id="zone3Info" class="zone-info-text">Click to draw on map</span>
                            </div>
                        </div>
                    </div>

                    <p class="help-text" style="margin-bottom: var(--spacing-md);">
                        Click a zone card to select it. Draw zones on map, or click existing zones to edit. Auto-saves locally.
                    </p>

                    <!-- Hidden inputs to maintain state compatibility -->
                    <input type="hidden" id="zone1Enable" value="false">
                    <input type="hidden" id="zone1X1" value="-1500">
                    <input type="hidden" id="zone1Y1" value="0">
                    <input type="hidden" id="zone1X2" value="1500">
                    <input type="hidden" id="zone1Y2" value="3000">
                    <input type="hidden" id="zone2Enable" value="false">
                    <input type="hidden" id="zone2X1" value="-1500">
                    <input type="hidden" id="zone2Y1" value="0">
                    <input type="hidden" id="zone2X2" value="1500">
                    <input type="hidden" id="zone2Y2" value="3000">
                    <input type="hidden" id="zone3Enable" value="false">
                    <input type="hidden" id="zone3X1" value="-1500">
                    <input type="hidden" id="zone3Y1" value="0">
                    <input type="hidden" id="zone3X2" value="1500">
                    <input type="hidden" id="zone3Y2" value="3000">

                    <div class="button-group">
                        <button id="applyZonesBtn" class="btn btn-primary">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
                                <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
                                <polyline points="17 21 17 13 7 13 7 21"/>
                                <polyline points="7 3 7 8 15 8"/>
                            </svg>
                            Save to Sensor
                        </button>
                        <button id="resetZonesBtn" class="btn btn-secondary">Clear All</button>
                    </div>
                </section>

                <!-- Live Target Data -->
                <section class="control-section">
                    <h2>Live Target Data</h2>
                    <div id="targetList" class="target-list">
                        <p class="text-muted">No targets detected</p>
                    </div>
                </section>
            </aside>
        </main>
    </div>

    <script type="module" src="/src/main.js"></script>
</body>
</html>
